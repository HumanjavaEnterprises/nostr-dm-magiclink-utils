<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>nostr-dm-magiclink-utils</title><meta name="description" content="Documentation for nostr-dm-magiclink-utils"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">nostr-dm-magiclink-utils</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>nostr-dm-magiclink-utils</h1></div><div class="tsd-panel tsd-typography"><h1 id="nostr-dm-magiclink-utils" class="tsd-anchor-link">nostr-dm-magiclink-utils<a href="#nostr-dm-magiclink-utils" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p><a href="https://www.npmjs.com/package/nostr-dm-magiclink-utils"><img src="https://img.shields.io/npm/v/nostr-dm-magiclink-utils.svg" alt="npm version"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a>
<a href="https://www.typescriptlang.org/"><img src="https://img.shields.io/badge/TypeScript-5.0-blue.svg" alt="TypeScript"></a>
<a href="https://nodejs.org"><img src="https://img.shields.io/node/v/nostr-dm-magiclink-utils.svg" alt="Node.js Version"></a>
<a href="https://codecov.io/gh/HumanjavaEnterprises/nostr-dm-magiclink-utils"><img src="https://img.shields.io/codecov/c/github/HumanjavaEnterprises/nostr-dm-magiclink-utils" alt="Test Coverage"></a>
<a href="https://github.com/HumanjavaEnterprises/nostr-dm-magiclink-utils/actions"><img src="https://img.shields.io/github/workflow/status/HumanjavaEnterprises/nostr-dm-magiclink-utils/CI" alt="Build Status"></a>
<a href="https://libraries.io/npm/nostr-dm-magiclink-utils"><img src="https://img.shields.io/librariesio/release/npm/nostr-dm-magiclink-utils" alt="Dependencies"></a>
<a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg" alt="Code Style: Prettier"></a>
<a href="https://github.com/vveerrgg"><img src="https://img.shields.io/badge/author-vveerrgg-blue.svg" alt="Author"></a>
<a href="https://bundlephobia.com/package/nostr-dm-magiclink-utils"><img src="https://img.shields.io/bundlephobia/minzip/nostr-dm-magiclink-utils" alt="Bundle Size"></a>
<a href="https://www.npmjs.com/package/nostr-dm-magiclink-utils"><img src="https://img.shields.io/npm/dm/nostr-dm-magiclink-utils.svg" alt="Downloads"></a>
<a href="https://github.com/HumanjavaEnterprises/nostr-dm-magiclink-utils#supported-languages"><img src="https://img.shields.io/badge/i18n-9_languages-green.svg" alt="Languages"></a>
<a href="https://github.com/nostr-protocol/nips/blob/master/04.md"><img src="https://img.shields.io/badge/security-NIP--04-brightgreen.svg" alt="Security"></a></p>
<p>A comprehensive Nostr utility library for implementing secure, user-friendly authentication via magic links in direct messages. Built with TypeScript and following Nostr Improvement Proposals (NIPs) for maximum compatibility and security.</p>
<h2 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<ul>
<li>ğŸ” <strong>NIP-04 Compliant</strong>: Secure, encrypted direct messages following Nostr standards</li>
<li>ğŸŒ <strong>Rich i18n Support</strong>: 9 languages with RTL support</li>
<li>ğŸ”„ <strong>Multi-Relay Support</strong>: Reliable message delivery with automatic failover</li>
<li>ğŸ›¡ï¸ <strong>Type-Safe</strong>: Full TypeScript support with comprehensive types</li>
<li>ğŸ“ <strong>Flexible Templates</strong>: Customizable messages with variable interpolation</li>
<li>ğŸš€ <strong>Modern API</strong>: Promise-based, async/await friendly interface</li>
<li>ğŸ¯ <strong>Zero Config</strong>: Sensible defaults with optional deep customization</li>
</ul>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">nostr-dm-magiclink-utils</span>
</code><button type="button">Copy</button></pre>

<h2 id="quick-start" class="tsd-anchor-link">Quick Start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Here's a complete example showing how to set up and use the magic link service:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createNostrMagicLink</span><span class="hl-1">, </span><span class="hl-4">NostrError</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;nostr-dm-magiclink-utils&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">generateKeyPair</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;nostr-crypto-utils&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">setupAuthService</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-6">// Create manager with secure configuration</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">magicLink</span><span class="hl-1"> = </span><span class="hl-0">createNostrMagicLink</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">nostr:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">// In production, load from secure environment variable</span><br/><span class="hl-1">      </span><span class="hl-4">privateKey:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">NOSTR_PRIVATE_KEY</span><span class="hl-1"> || </span><span class="hl-0">generateKeyPair</span><span class="hl-1">().</span><span class="hl-4">privateKey</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">relayUrls:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-2">&#39;wss://relay.damus.io&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&#39;wss://relay.nostr.band&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&#39;wss://nos.lol&#39;</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">      </span><span class="hl-6">// Optional: Configure connection timeouts</span><br/><span class="hl-1">      </span><span class="hl-4">connectionTimeout:</span><span class="hl-1"> </span><span class="hl-8">5000</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">magicLink:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">verifyUrl:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://your-app.com/verify&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">// Async token generation with expiry</span><br/><span class="hl-1">      </span><span class="hl-0">token</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">token</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">generateSecureToken</span><span class="hl-1">({</span><br/><span class="hl-1">          </span><span class="hl-4">expiresIn:</span><span class="hl-1"> </span><span class="hl-2">&#39;15m&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">length:</span><span class="hl-1"> </span><span class="hl-8">32</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">token</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">defaultLocale:</span><span class="hl-1"> </span><span class="hl-2">&#39;en&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">// Optional: Custom message templates</span><br/><span class="hl-1">      </span><span class="hl-4">templates:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">en:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">subject:</span><span class="hl-1"> </span><span class="hl-2">&#39;Login to {{appName}}&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">body:</span><span class="hl-1"> </span><span class="hl-2">&#39;Click this secure link to log in: {{link}}</span><span class="hl-9">\n</span><span class="hl-2">Valid for 15 minutes.&#39;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">magicLink</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">// Example usage in an Express route handler</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">post</span><span class="hl-1">(</span><span class="hl-2">&#39;/auth/magic-link&#39;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-7">pubkey</span><span class="hl-1"> } = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">pubkey</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-2">&#39;Missing pubkey&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">magicLink</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">setupAuthService</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">sendMagicLink</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">recipientPubkey:</span><span class="hl-1"> </span><span class="hl-4">pubkey</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">messageOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">locale:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">locale</span><span class="hl-1">, </span><span class="hl-6">// From i18n middleware</span><br/><span class="hl-1">        </span><span class="hl-4">variables:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;YourApp&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">username:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">username</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">success</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">({ </span><br/><span class="hl-1">        </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-2">&#39;Magic link sent successfully&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">expiresIn:</span><span class="hl-1"> </span><span class="hl-2">&#39;15 minutes&#39;</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-5">instanceof</span><span class="hl-1"> </span><span class="hl-10">NostrError</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">// Handle specific Nostr-related errors</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-0">json</span><span class="hl-1">({ </span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">code:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">code</span><span class="hl-1"> </span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">// Handle unexpected errors</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-8">500</span><span class="hl-1">).</span><span class="hl-0">json</span><span class="hl-1">({ </span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-2">&#39;Failed to send magic link&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="advanced-usage" class="tsd-anchor-link">Advanced Usage<a href="#advanced-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="custom-error-handling" class="tsd-anchor-link">Custom Error Handling<a href="#custom-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code class="typescript"><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">sendMagicLink</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">recipientPubkey:</span><span class="hl-1"> </span><span class="hl-4">pubkey</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">messageOptions:</span><span class="hl-1"> { </span><span class="hl-4">locale:</span><span class="hl-1"> </span><span class="hl-2">&#39;en&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">success</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">switch</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">code</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&#39;RELAY_CONNECTION_FAILED&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-6">// Attempt reconnection or use fallback relay</span><br/><span class="hl-1">        </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">reconnect</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&#39;ENCRYPTION_FAILED&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-6">// Log encryption errors for debugging</span><br/><span class="hl-1">        </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Encryption failed:&#39;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&#39;INVALID_PUBKEY&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-6">// Handle invalid recipient public key</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">UserError</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid recipient&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">break</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">// Handle other errors</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="multi-language-support" class="tsd-anchor-link">Multi-Language Support<a href="#multi-language-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code class="typescript"><span class="hl-6">// Arabic (RTL) example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">sendMagicLink</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">recipientPubkey:</span><span class="hl-1"> </span><span class="hl-4">pubkey</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">messageOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">locale:</span><span class="hl-1"> </span><span class="hl-2">&#39;ar&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">// Optional: Override default template</span><br/><span class="hl-1">    </span><span class="hl-4">template:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">subject:</span><span class="hl-1"> </span><span class="hl-2">&#39;ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ {{appName}}&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">body:</span><span class="hl-1"> </span><span class="hl-2">&#39;Ø§Ù†Ù‚Ø± ÙÙˆÙ‚ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¢Ù…Ù† Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: {{link}}&#39;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">variables:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;ØªØ·Ø¨ÙŠÙ‚Ùƒ&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">username:</span><span class="hl-1"> </span><span class="hl-2">&#39;Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="custom-token-generation" class="tsd-anchor-link">Custom Token Generation<a href="#custom-token-generation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">magicLink</span><span class="hl-1"> = </span><span class="hl-0">createNostrMagicLink</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">// ... other config</span><br/><span class="hl-1">  </span><span class="hl-4">magicLink:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">verifyUrl:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://your-app.com/verify&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">token</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">recipientPubkey</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">// Generate a secure, short-lived token</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">token</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">generateJWT</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">sub:</span><span class="hl-1"> </span><span class="hl-4">recipientPubkey</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">exp:</span><span class="hl-1"> </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() / </span><span class="hl-8">1000</span><span class="hl-1">) + (</span><span class="hl-8">15</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1">), </span><span class="hl-6">// 15 minutes</span><br/><span class="hl-1">        </span><span class="hl-4">jti:</span><span class="hl-1"> </span><span class="hl-4">crypto</span><span class="hl-1">.</span><span class="hl-0">randomUUID</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-4">iss:</span><span class="hl-1"> </span><span class="hl-2">&#39;your-app&#39;</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-6">// Optional: Store token in database for verification</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-4">tokens</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">token</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">pubkey:</span><span class="hl-1"> </span><span class="hl-4">recipientPubkey</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">expiresAt:</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() + </span><span class="hl-8">15</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1"> * </span><span class="hl-8">1000</span><span class="hl-1">)</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">token</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="relay-management" class="tsd-anchor-link">Relay Management<a href="#relay-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">magicLink</span><span class="hl-1"> = </span><span class="hl-0">createNostrMagicLink</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">nostr:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">privateKey:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">NOSTR_PRIVATE_KEY</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">relayUrls:</span><span class="hl-1"> [</span><span class="hl-2">&#39;wss://relay1.com&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;wss://relay2.com&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">// Advanced relay options</span><br/><span class="hl-1">    </span><span class="hl-4">relayOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">retryAttempts:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">retryDelay:</span><span class="hl-1"> </span><span class="hl-8">1000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-8">5000</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">onError</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">relay</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Relay </span><span class="hl-5">${</span><span class="hl-4">relay</span><span class="hl-5">}</span><span class="hl-2"> error:`</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">// Optionally switch to backup relay</span><br/><span class="hl-1">        </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">addRelay</span><span class="hl-1">(</span><span class="hl-2">&#39;wss://backup-relay.com&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">// Monitor relay status</span><br/><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;relay:connected&#39;</span><span class="hl-1">, (</span><span class="hl-4">relay</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">`Connected to relay: </span><span class="hl-5">${</span><span class="hl-4">relay</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">magicLink</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;relay:disconnected&#39;</span><span class="hl-1">, (</span><span class="hl-4">relay</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Disconnected from relay: </span><span class="hl-5">${</span><span class="hl-4">relay</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="security-best-practices" class="tsd-anchor-link">Security Best Practices<a href="#security-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="dependency-vulnerability-status" class="tsd-anchor-link">Dependency Vulnerability Status<a href="#dependency-vulnerability-status" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>We actively monitor and address security vulnerabilities in this codebase. <strong><code>npm audit --omit=dev</code> reports zero vulnerabilities</strong> for this package â€” there are no known security issues in production dependencies.</p>
<p>Any remaining <code>npm audit</code> findings are in development-only tooling (eslint, typescript-eslint, vitest, typedoc, etc.) and stem from transitive dependencies with no upstream fix available. These are devDependencies that are never included in the published package and pose no risk to consumers of this library. We monitor upstream fixes and update promptly when they become available.</p>
<ol>
<li><strong>Private Key Management</strong>
<ul>
<li>Never hardcode private keys</li>
<li>Use secure environment variables</li>
<li>Rotate keys periodically</li>
</ul>
</li>
</ol>
<pre><code class="typescript"><span class="hl-6">// Load private key securely</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">privateKey</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">loadPrivateKeyFromSecureStore</span><span class="hl-1">();</span><br/><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">privateKey</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Missing required private key&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<ol start="2">
<li>
<p><strong>Token Security</strong></p>
<ul>
<li>Use short expiration times (15-30 minutes)</li>
<li>Include necessary claims (sub, exp, jti)</li>
<li>Store tokens securely for verification</li>
</ul>
</li>
<li>
<p><strong>Error Handling</strong></p>
<ul>
<li>Never expose internal errors to users</li>
<li>Log errors securely</li>
<li>Implement rate limiting</li>
</ul>
</li>
<li>
<p><strong>Relay Security</strong></p>
<ul>
<li>Use trusted relays</li>
<li>Implement connection timeouts</li>
<li>Handle connection errors gracefully</li>
</ul>
</li>
</ol>
<h2 id="supported-languages" class="tsd-anchor-link">Supported Languages<a href="#supported-languages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>The library includes built-in support for:</p>
<ul>
<li>ğŸ‡ºğŸ‡¸ English (en)</li>
<li>ğŸ‡ªğŸ‡¸ Spanish (es)</li>
<li>ğŸ‡«ğŸ‡· French (fr)</li>
<li>ğŸ‡¯ğŸ‡µ Japanese (ja)</li>
<li>ğŸ‡°ğŸ‡· Korean (ko)</li>
<li>ğŸ‡¨ğŸ‡³ Chinese (zh)</li>
<li>ğŸ‡§ğŸ‡· Portuguese (pt)</li>
<li>ğŸ‡·ğŸ‡º Russian (ru)</li>
<li>ğŸ‡¸ğŸ‡¦ Arabic (ar) - with RTL support</li>
</ul>
<h2 id="contributing" class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>See <a href="media/CONTRIBUTING.md">CONTRIBUTING.md</a> for development setup and guidelines.</p>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>MIT Â© <a href="https://github.com/vveerrgg">vveerrgg</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#nostr-dm-magiclink-utils"><span>nostr-<wbr/>dm-<wbr/>magiclink-<wbr/>utils</span></a><ul><li><a href="#features"><span>Features</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#quick-start"><span>Quick <wbr/>Start</span></a></li><li><a href="#advanced-usage"><span>Advanced <wbr/>Usage</span></a></li><li><ul><li><a href="#custom-error-handling"><span>Custom <wbr/>Error <wbr/>Handling</span></a></li><li><a href="#multi-language-support"><span>Multi-<wbr/>Language <wbr/>Support</span></a></li><li><a href="#custom-token-generation"><span>Custom <wbr/>Token <wbr/>Generation</span></a></li><li><a href="#relay-management"><span>Relay <wbr/>Management</span></a></li></ul></li><li><a href="#security-best-practices"><span>Security <wbr/>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#dependency-vulnerability-status"><span>Dependency <wbr/>Vulnerability <wbr/>Status</span></a></li></ul></li><li><a href="#supported-languages"><span>Supported <wbr/>Languages</span></a></li><li><a href="#contributing"><span>Contributing</span></a></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">nostr-dm-magiclink-utils</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
